<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>src/OpenCV/ImgProc/MiscImgTransform.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>{-# language CPP #-}</span>
<a name="line-2"></a><span class='hs-comment'>{-# language QuasiQuotes #-}</span>
<a name="line-3"></a><span class='hs-comment'>{-# language TemplateHaskell #-}</span>
<a name="line-4"></a>
<a name="line-5"></a><span class='hs-cpp'>#if __GLASGOW_HASKELL__ &gt;= 800</span>
<a name="line-6"></a><span class='hs-comment'>{-# options_ghc -Wno-redundant-constraints #-}</span>
<a name="line-7"></a><span class='hs-cpp'>#endif</span>
<a name="line-8"></a>
<a name="line-9"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>OpenCV</span><span class='hs-varop'>.</span><span class='hs-conid'>ImgProc</span><span class='hs-varop'>.</span><span class='hs-conid'>MiscImgTransform</span>
<a name="line-10"></a>    <span class='hs-layout'>(</span> <span class='hs-comment'>-- * Color conversion</span>
<a name="line-11"></a>      <span class='hs-varid'>cvtColor</span>
<a name="line-12"></a>    <span class='hs-layout'>,</span> <span class='hs-keyword'>module</span> <span class='hs-conid'>OpenCV</span><span class='hs-varop'>.</span><span class='hs-conid'>ImgProc</span><span class='hs-varop'>.</span><span class='hs-conid'>MiscImgTransform</span><span class='hs-varop'>.</span><span class='hs-conid'>ColorCodes</span>
<a name="line-13"></a>
<a name="line-14"></a>      <span class='hs-comment'>-- * Flood filling</span>
<a name="line-15"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>floodFill</span>
<a name="line-16"></a>    <span class='hs-layout'>,</span> <span class='hs-conid'>FloodFillOperationFlags</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span>
<a name="line-17"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>defaultFloodFillOperationFlags</span>
<a name="line-18"></a>
<a name="line-19"></a>      <span class='hs-comment'>-- * Thresholding</span>
<a name="line-20"></a>    <span class='hs-layout'>,</span> <span class='hs-conid'>ThreshType</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span>
<a name="line-21"></a>    <span class='hs-layout'>,</span> <span class='hs-conid'>ThreshValue</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span>
<a name="line-22"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>threshold</span>
<a name="line-23"></a>
<a name="line-24"></a>      <span class='hs-comment'>-- * Watershed</span>
<a name="line-25"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>watershed</span>
<a name="line-26"></a>    <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-27"></a>
<a name="line-28"></a><span class='hs-keyword'>import</span> <span class='hs-str'>"base"</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Bits</span>
<a name="line-29"></a><span class='hs-keyword'>import</span> <span class='hs-str'>"base"</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Int</span>
<a name="line-30"></a><span class='hs-keyword'>import</span> <span class='hs-str'>"base"</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Proxy</span> <span class='hs-layout'>(</span> <span class='hs-conid'>Proxy</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span> <span class='hs-layout'>)</span>
<a name="line-31"></a><span class='hs-keyword'>import</span> <span class='hs-str'>"base"</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Word</span>
<a name="line-32"></a><span class='hs-keyword'>import</span> <span class='hs-str'>"base"</span> <span class='hs-conid'>Foreign</span><span class='hs-varop'>.</span><span class='hs-conid'>Marshal</span><span class='hs-varop'>.</span><span class='hs-conid'>Alloc</span> <span class='hs-layout'>(</span> <span class='hs-varid'>alloca</span> <span class='hs-layout'>)</span>
<a name="line-33"></a><span class='hs-keyword'>import</span> <span class='hs-str'>"base"</span> <span class='hs-conid'>Foreign</span><span class='hs-varop'>.</span><span class='hs-conid'>Storable</span> <span class='hs-layout'>(</span> <span class='hs-varid'>peek</span> <span class='hs-layout'>)</span>
<a name="line-34"></a><span class='hs-keyword'>import</span> <span class='hs-str'>"base"</span> <span class='hs-conid'>GHC</span><span class='hs-varop'>.</span><span class='hs-conid'>TypeLits</span>
<a name="line-35"></a><span class='hs-keyword'>import</span> <span class='hs-str'>"primitive"</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Monad</span><span class='hs-varop'>.</span><span class='hs-conid'>Primitive</span> <span class='hs-layout'>(</span> <span class='hs-conid'>PrimMonad</span><span class='hs-layout'>,</span> <span class='hs-conid'>PrimState</span><span class='hs-layout'>,</span> <span class='hs-varid'>unsafePrimToPrim</span> <span class='hs-layout'>)</span>
<a name="line-36"></a><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-str'>"inline-c"</span> <span class='hs-conid'>Language</span><span class='hs-varop'>.</span><span class='hs-conid'>C</span><span class='hs-varop'>.</span><span class='hs-conid'>Inline</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>C</span>
<a name="line-37"></a><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-str'>"inline-c-cpp"</span> <span class='hs-conid'>Language</span><span class='hs-varop'>.</span><span class='hs-conid'>C</span><span class='hs-varop'>.</span><span class='hs-conid'>Inline</span><span class='hs-varop'>.</span><span class='hs-conid'>Cpp</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>C</span>
<a name="line-38"></a><span class='hs-keyword'>import</span> <span class='hs-str'>"linear"</span> <span class='hs-conid'>Linear</span><span class='hs-varop'>.</span><span class='hs-conid'>V4</span> <span class='hs-layout'>(</span> <span class='hs-conid'>V4</span> <span class='hs-layout'>)</span>
<a name="line-39"></a><span class='hs-keyword'>import</span> <span class='hs-str'>"this"</span> <span class='hs-conid'>OpenCV</span><span class='hs-varop'>.</span><span class='hs-conid'>Core</span><span class='hs-varop'>.</span><span class='hs-conid'>Types</span>
<a name="line-40"></a><span class='hs-keyword'>import</span> <span class='hs-str'>"this"</span> <span class='hs-conid'>OpenCV</span><span class='hs-varop'>.</span><span class='hs-conid'>ImgProc</span><span class='hs-varop'>.</span><span class='hs-conid'>MiscImgTransform</span><span class='hs-varop'>.</span><span class='hs-conid'>ColorCodes</span>
<a name="line-41"></a><span class='hs-keyword'>import</span> <span class='hs-str'>"this"</span> <span class='hs-conid'>OpenCV</span><span class='hs-varop'>.</span><span class='hs-conid'>Internal</span><span class='hs-varop'>.</span><span class='hs-conid'>C</span><span class='hs-varop'>.</span><span class='hs-conid'>Inline</span> <span class='hs-layout'>(</span> <span class='hs-varid'>openCvCtx</span> <span class='hs-layout'>)</span>
<a name="line-42"></a><span class='hs-keyword'>import</span> <span class='hs-str'>"this"</span> <span class='hs-conid'>OpenCV</span><span class='hs-varop'>.</span><span class='hs-conid'>Internal</span><span class='hs-varop'>.</span><span class='hs-conid'>C</span><span class='hs-varop'>.</span><span class='hs-conid'>Types</span>
<a name="line-43"></a><span class='hs-keyword'>import</span> <span class='hs-str'>"this"</span> <span class='hs-conid'>OpenCV</span><span class='hs-varop'>.</span><span class='hs-conid'>Internal</span><span class='hs-varop'>.</span><span class='hs-conid'>Exception</span>
<a name="line-44"></a><span class='hs-keyword'>import</span> <span class='hs-str'>"this"</span> <span class='hs-conid'>OpenCV</span><span class='hs-varop'>.</span><span class='hs-conid'>Internal</span><span class='hs-varop'>.</span><span class='hs-conid'>Core</span><span class='hs-varop'>.</span><span class='hs-conid'>Types</span><span class='hs-varop'>.</span><span class='hs-conid'>Mat</span>
<a name="line-45"></a><span class='hs-keyword'>import</span> <span class='hs-str'>"this"</span> <span class='hs-conid'>OpenCV</span><span class='hs-varop'>.</span><span class='hs-conid'>Internal</span><span class='hs-varop'>.</span><span class='hs-conid'>ImgProc</span><span class='hs-varop'>.</span><span class='hs-conid'>MiscImgTransform</span>
<a name="line-46"></a><span class='hs-keyword'>import</span> <span class='hs-str'>"this"</span> <span class='hs-conid'>OpenCV</span><span class='hs-varop'>.</span><span class='hs-conid'>Internal</span><span class='hs-varop'>.</span><span class='hs-conid'>ImgProc</span><span class='hs-varop'>.</span><span class='hs-conid'>MiscImgTransform</span><span class='hs-varop'>.</span><span class='hs-conid'>TypeLevel</span>
<a name="line-47"></a><span class='hs-keyword'>import</span> <span class='hs-str'>"this"</span> <span class='hs-conid'>OpenCV</span><span class='hs-varop'>.</span><span class='hs-conid'>Internal</span><span class='hs-varop'>.</span><span class='hs-conid'>ImgProc</span><span class='hs-varop'>.</span><span class='hs-conid'>MiscImgTransform</span><span class='hs-varop'>.</span><span class='hs-conid'>ColorCodes</span> <span class='hs-layout'>(</span> <span class='hs-varid'>colorConversionCode</span> <span class='hs-layout'>)</span>
<a name="line-48"></a><span class='hs-keyword'>import</span> <span class='hs-str'>"this"</span> <span class='hs-conid'>OpenCV</span><span class='hs-varop'>.</span><span class='hs-conid'>TypeLevel</span>
<a name="line-49"></a>
<a name="line-50"></a><span class='hs-comment'>--------------------------------------------------------------------------------</span>
<a name="line-51"></a>
<a name="line-52"></a><span class='hs-conid'>C</span><span class='hs-varop'>.</span><span class='hs-varid'>context</span> <span class='hs-varid'>openCvCtx</span>
<a name="line-53"></a>
<a name="line-54"></a><span class='hs-conid'>C</span><span class='hs-varop'>.</span><span class='hs-varid'>include</span> <span class='hs-str'>"opencv2/core.hpp"</span>
<a name="line-55"></a><span class='hs-conid'>C</span><span class='hs-varop'>.</span><span class='hs-varid'>include</span> <span class='hs-str'>"opencv2/imgproc.hpp"</span>
<a name="line-56"></a><span class='hs-conid'>C</span><span class='hs-varop'>.</span><span class='hs-varid'>using</span> <span class='hs-str'>"namespace cv"</span>
<a name="line-57"></a>
<a name="line-58"></a><span class='hs-comment'>--------------------------------------------------------------------------------</span>
<a name="line-59"></a>
<a name="line-60"></a><span class='hs-comment'>-- ignore next Haddock code block, because of the hash sign in the link at the end of the comment.</span>
<a name="line-61"></a><span class='hs-comment'>{- | Converts an image from one color space to another
<a name="line-62"></a>
<a name="line-63"></a>The function converts an input image from one color space to
<a name="line-64"></a>another. In case of a transformation to-from RGB color space, the
<a name="line-65"></a>order of the channels should be specified explicitly (RGB or
<a name="line-66"></a>BGR). Note that the default color format in OpenCV is often
<a name="line-67"></a>referred to as RGB but it is actually BGR (the bytes are
<a name="line-68"></a>reversed). So the first byte in a standard (24-bit) color image
<a name="line-69"></a>will be an 8-bit Blue component, the second byte will be Green, and
<a name="line-70"></a>the third byte will be Red. The fourth, fifth, and sixth bytes
<a name="line-71"></a>would then be the second pixel (Blue, then Green, then Red), and so
<a name="line-72"></a>on.
<a name="line-73"></a>
<a name="line-74"></a>The conventional ranges for R, G, and B channel values are:
<a name="line-75"></a>
<a name="line-76"></a>  * 0 to 255 for 'Word8' images
<a name="line-77"></a>
<a name="line-78"></a>  * 0 to 65535 for 'Word16' images
<a name="line-79"></a>
<a name="line-80"></a>  * 0 to 1 for 'Float' images
<a name="line-81"></a>
<a name="line-82"></a>In case of linear transformations, the range does not matter. But
<a name="line-83"></a>in case of a non-linear transformation, an input RGB image should
<a name="line-84"></a>be normalized to the proper value range to get the correct results,
<a name="line-85"></a>for example, for RGB to L*u*v* transformation. For example, if you
<a name="line-86"></a>have a 32-bit floating-point image directly converted from an 8-bit
<a name="line-87"></a>image without any scaling, then it will have the 0..255 value range
<a name="line-88"></a>instead of 0..1 assumed by the function. So, before calling
<a name="line-89"></a>'cvtColor', you need first to scale the image down:
<a name="line-90"></a>
<a name="line-91"></a>&gt;  cvtColor (img * 1/255) 'ColorConvBGR2Luv'
<a name="line-92"></a>
<a name="line-93"></a>If you use 'cvtColor' with 8-bit images, the conversion will have
<a name="line-94"></a>some information lost. For many applications, this will not be
<a name="line-95"></a>noticeable but it is recommended to use 32-bit images in
<a name="line-96"></a>applications that need the full range of colors or that convert an
<a name="line-97"></a>image before an operation and then convert back.
<a name="line-98"></a>
<a name="line-99"></a>If conversion adds the alpha channel, its value will set to the
<a name="line-100"></a>maximum of corresponding channel range: 255 for 'Word8', 65535 for
<a name="line-101"></a>'Word16', 1 for 'Float'.
<a name="line-102"></a>
<a name="line-103"></a>Example:
<a name="line-104"></a>
<a name="line-105"></a>@
<a name="line-106"></a>cvtColorImg
<a name="line-107"></a>    :: forall (width    :: Nat)
<a name="line-108"></a>              (width2   :: Nat)
<a name="line-109"></a>              (height   :: Nat)
<a name="line-110"></a>              (channels :: Nat)
<a name="line-111"></a>              (depth    :: *)
<a name="line-112"></a>     . ( Mat (ShapeT [height, width]) ('S channels) ('S depth) ~ Birds_512x341
<a name="line-113"></a>       , width2 ~ (width + width)
<a name="line-114"></a>       )
<a name="line-115"></a>    =&gt; Mat (ShapeT [height, width2]) ('S channels) ('S depth)
<a name="line-116"></a>cvtColorImg = exceptError $
<a name="line-117"></a>    withMatM ((Proxy :: Proxy height) ::: (Proxy :: Proxy width2) ::: Z)
<a name="line-118"></a>             (Proxy :: Proxy channels)
<a name="line-119"></a>             (Proxy :: Proxy depth)
<a name="line-120"></a>             white $ \imgM -&gt; do
<a name="line-121"></a>      birds_gray &lt;- pureExcept $   cvtColor gray bgr
<a name="line-122"></a>                               =&lt;&lt; cvtColor bgr gray birds_512x341
<a name="line-123"></a>      matCopyToM imgM (V2 0 0) birds_512x341 Nothing
<a name="line-124"></a>      matCopyToM imgM (V2 w 0) birds_gray    Nothing
<a name="line-125"></a>      lift $ arrowedLine imgM (V2 startX midY) (V2 pointX midY) red 4 LineType_8 0 0.15
<a name="line-126"></a>  where
<a name="line-127"></a>    h, w :: Int32
<a name="line-128"></a>    h = fromInteger $ natVal (Proxy :: Proxy height)
<a name="line-129"></a>    w = fromInteger $ natVal (Proxy :: Proxy width)
<a name="line-130"></a>
<a name="line-131"></a>    startX, pointX :: Int32
<a name="line-132"></a>    startX = round $ fromIntegral w * (0.95 :: Double)
<a name="line-133"></a>    pointX = round $ fromIntegral w * (1.05 :: Double)
<a name="line-134"></a>    midY = h \`div\` 2
<a name="line-135"></a>@
<a name="line-136"></a>
<a name="line-137"></a>&lt;&lt;doc/generated/examples/cvtColorImg.png cvtColorImg&gt;&gt;
<a name="line-138"></a>
<a name="line-139"></a>&lt;<a href="http://goo.gl/3rfrhu">http://goo.gl/3rfrhu</a> OpenCV Sphinx Doc&gt;
<a name="line-140"></a>-}</span>
<a name="line-141"></a>
<a name="line-142"></a><span class='hs-comment'>-- the link avove is minified because it includes a hash, which the CPP tries to parse and fails</span>
<a name="line-143"></a>
<a name="line-144"></a><a name="cvtColor"></a><span class='hs-comment'>-- TODO (RvD): Allow value level color codes</span>
<a name="line-145"></a><span class='hs-comment'>-- Allow statically unknown color codes: fromColor :: DS ColorCode</span>
<a name="line-146"></a><span class='hs-definition'>cvtColor</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromColor</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ColorCode</span><span class='hs-layout'>)</span>
<a name="line-147"></a>                   <span class='hs-layout'>(</span><span class='hs-varid'>toColor</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ColorCode</span><span class='hs-layout'>)</span>
<a name="line-148"></a>                   <span class='hs-layout'>(</span><span class='hs-varid'>shape</span>       <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DS</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>DS</span> <span class='hs-conid'>Nat</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-149"></a>                   <span class='hs-layout'>(</span><span class='hs-varid'>srcChannels</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DS</span> <span class='hs-conid'>Nat</span><span class='hs-layout'>)</span>
<a name="line-150"></a>                   <span class='hs-layout'>(</span><span class='hs-varid'>dstChannels</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DS</span> <span class='hs-conid'>Nat</span><span class='hs-layout'>)</span>
<a name="line-151"></a>                   <span class='hs-layout'>(</span><span class='hs-varid'>srcDepth</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DS</span> <span class='hs-varop'>*</span><span class='hs-layout'>)</span>
<a name="line-152"></a>                   <span class='hs-layout'>(</span><span class='hs-varid'>dstDepth</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DS</span> <span class='hs-varop'>*</span><span class='hs-layout'>)</span>
<a name="line-153"></a>          <span class='hs-varop'>.</span> <span class='hs-layout'>(</span> <span class='hs-conid'>ColorConversion</span> <span class='hs-varid'>fromColor</span> <span class='hs-varid'>toColor</span>
<a name="line-154"></a>            <span class='hs-layout'>,</span> <span class='hs-conid'>ColorCodeMatchesChannels</span> <span class='hs-varid'>fromColor</span> <span class='hs-varid'>srcChannels</span>
<a name="line-155"></a>            <span class='hs-layout'>,</span> <span class='hs-varid'>dstChannels</span> <span class='hs-keyglyph'>~</span> <span class='hs-chr'>'</span><span class='hs-conid'>S</span> <span class='hs-layout'>(</span><span class='hs-conid'>ColorCodeChannels</span> <span class='hs-varid'>toColor</span><span class='hs-layout'>)</span>
<a name="line-156"></a>            <span class='hs-layout'>,</span> <span class='hs-varid'>srcDepth</span> <span class='hs-varop'>`In`</span> <span class='hs-keyglyph'>[</span><span class='hs-chr'>'</span><span class='hs-conid'>D</span><span class='hs-layout'>,</span> <span class='hs-chr'>'</span><span class='hs-conid'>S</span> <span class='hs-conid'>Word8</span><span class='hs-layout'>,</span> <span class='hs-chr'>'</span><span class='hs-conid'>S</span> <span class='hs-conid'>Word16</span><span class='hs-layout'>,</span> <span class='hs-chr'>'</span><span class='hs-conid'>S</span> <span class='hs-conid'>Float</span><span class='hs-keyglyph'>]</span>
<a name="line-157"></a>            <span class='hs-layout'>,</span> <span class='hs-varid'>dstDepth</span> <span class='hs-keyglyph'>~</span> <span class='hs-conid'>ColorCodeDepth</span> <span class='hs-varid'>fromColor</span> <span class='hs-varid'>toColor</span> <span class='hs-varid'>srcDepth</span>
<a name="line-158"></a>            <span class='hs-layout'>)</span>
<a name="line-159"></a>         <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>fromColor</span> <span class='hs-comment'>-- ^ Convert from 'ColorCode'. Make sure the source image has this 'ColorCode'</span>
<a name="line-160"></a>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Proxy</span> <span class='hs-varid'>toColor</span>   <span class='hs-comment'>-- ^ Convert to 'ColorCode'.</span>
<a name="line-161"></a>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Mat</span> <span class='hs-varid'>shape</span> <span class='hs-varid'>srcChannels</span> <span class='hs-varid'>srcDepth</span> <span class='hs-comment'>-- ^ Source image</span>
<a name="line-162"></a>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CvExcept</span> <span class='hs-layout'>(</span><span class='hs-conid'>Mat</span> <span class='hs-varid'>shape</span> <span class='hs-varid'>dstChannels</span> <span class='hs-varid'>dstDepth</span><span class='hs-layout'>)</span>
<a name="line-163"></a><span class='hs-definition'>cvtColor</span> <span class='hs-varid'>fromColor</span> <span class='hs-varid'>toColor</span> <span class='hs-varid'>src</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unsafeWrapException</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<a name="line-164"></a>    <span class='hs-varid'>dst</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>newEmptyMat</span>
<a name="line-165"></a>    <span class='hs-varid'>handleCvException</span> <span class='hs-layout'>(</span><span class='hs-varid'>pure</span> <span class='hs-varop'>$</span> <span class='hs-varid'>unsafeCoerceMat</span> <span class='hs-varid'>dst</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span>
<a name="line-166"></a>      <span class='hs-varid'>withPtr</span> <span class='hs-varid'>src</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>srcPtr</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-167"></a>      <span class='hs-varid'>withPtr</span> <span class='hs-varid'>dst</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>dstPtr</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-168"></a>        <span class='hs-keyglyph'>[</span><span class='hs-varid'>cvExcept</span><span class='hs-keyglyph'>|</span>
<a name="line-169"></a>          <span class='hs-varid'>cv</span><span class='hs-keyglyph'>::</span><span class='hs-varid'>cvtColor</span><span class='hs-layout'>(</span> <span class='hs-varop'>*$</span><span class='hs-layout'>(</span><span class='hs-conid'>Mat</span> <span class='hs-varop'>*</span> <span class='hs-varid'>srcPtr</span><span class='hs-layout'>)</span>
<a name="line-170"></a>                      <span class='hs-layout'>,</span> <span class='hs-varop'>*$</span><span class='hs-layout'>(</span><span class='hs-conid'>Mat</span> <span class='hs-varop'>*</span> <span class='hs-varid'>dstPtr</span><span class='hs-layout'>)</span>
<a name="line-171"></a>                      <span class='hs-layout'>,</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>int32_t</span> <span class='hs-varid'>c'code</span><span class='hs-layout'>)</span>
<a name="line-172"></a>                      <span class='hs-layout'>,</span> <span class='hs-num'>0</span>
<a name="line-173"></a>                      <span class='hs-layout'>)</span><span class='hs-layout'>;</span>
<a name="line-174"></a>        <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-175"></a>  <span class='hs-keyword'>where</span>
<a name="line-176"></a>    <span class='hs-varid'>c'code</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>colorConversionCode</span> <span class='hs-varid'>fromColor</span> <span class='hs-varid'>toColor</span>
<a name="line-177"></a>
<a name="line-178"></a><a name="floodFill"></a><span class='hs-comment'>{- | The function 'floodFill' fills a connected component starting from the seed point with the specified color.
<a name="line-179"></a>
<a name="line-180"></a>The connectivity is determined by the color/brightness closeness of the neighbor pixels. See the OpenCV
<a name="line-181"></a>documentation for details on the algorithm.
<a name="line-182"></a>
<a name="line-183"></a>Example:
<a name="line-184"></a>
<a name="line-185"></a>@
<a name="line-186"></a>floodFillImg
<a name="line-187"></a>    :: forall (width    :: Nat)
<a name="line-188"></a>              (width2   :: Nat)
<a name="line-189"></a>              (height   :: Nat)
<a name="line-190"></a>              (channels :: Nat)
<a name="line-191"></a>              (depth    :: *)
<a name="line-192"></a>     . ( Mat (ShapeT [height, width]) ('S channels) ('S depth) ~ Sailboat_768x512
<a name="line-193"></a>       , width2 ~ (width + width)
<a name="line-194"></a>       )
<a name="line-195"></a>    =&gt; Mat (ShapeT [height, width2]) ('S channels) ('S depth)
<a name="line-196"></a>floodFillImg = exceptError $
<a name="line-197"></a>    withMatM ((Proxy :: Proxy height) ::: (Proxy :: Proxy width2) ::: Z)
<a name="line-198"></a>             (Proxy :: Proxy channels)
<a name="line-199"></a>             (Proxy :: Proxy depth)
<a name="line-200"></a>             white $ \imgM -&gt; do
<a name="line-201"></a>      sailboatEvening_768x512 &lt;- thaw sailboat_768x512
<a name="line-202"></a>      mask &lt;- mkMatM (Proxy :: Proxy [height + 2, width + 2])
<a name="line-203"></a>                     (Proxy :: Proxy 1)
<a name="line-204"></a>                     (Proxy :: Proxy Word8)
<a name="line-205"></a>                     black
<a name="line-206"></a>      circle mask (V2 450 120 :: V2 Int32) 45 white (-1) LineType_AA 0
<a name="line-207"></a>      rect &lt;- floodFill sailboatEvening_768x512 (Just mask) seedPoint eveningRed (Just tolerance) (Just tolerance) defaultFloodFillOperationFlags
<a name="line-208"></a>      rectangle sailboatEvening_768x512 rect blue 2 LineType_8 0
<a name="line-209"></a>      frozenSailboatEvening_768x512 &lt;- freeze sailboatEvening_768x512
<a name="line-210"></a>      matCopyToM imgM (V2 0 0) sailboat_768x512 Nothing
<a name="line-211"></a>      matCopyToM imgM (V2 w 0) frozenSailboatEvening_768x512 Nothing
<a name="line-212"></a>      lift $ arrowedLine imgM (V2 startX midY) (V2 pointX midY) red 4 LineType_8 0 0.15
<a name="line-213"></a>  where
<a name="line-214"></a>    h, w :: Int32
<a name="line-215"></a>    h = fromInteger $ natVal (Proxy :: Proxy height)
<a name="line-216"></a>    w = fromInteger $ natVal (Proxy :: Proxy width)
<a name="line-217"></a>
<a name="line-218"></a>    startX, pointX :: Int32
<a name="line-219"></a>    startX = round $ fromIntegral w * (0.95 :: Double)
<a name="line-220"></a>    pointX = round $ fromIntegral w * (1.05 :: Double)
<a name="line-221"></a>
<a name="line-222"></a>    midY = h \`div\` 2
<a name="line-223"></a>
<a name="line-224"></a>    seedPoint :: V2 Int32
<a name="line-225"></a>    seedPoint = V2 100 50
<a name="line-226"></a>
<a name="line-227"></a>    eveningRed :: V4 Double
<a name="line-228"></a>    eveningRed = V4 0 100 200 255
<a name="line-229"></a>
<a name="line-230"></a>    tolerance :: V4 Double
<a name="line-231"></a>    tolerance = pure 7
<a name="line-232"></a>@
<a name="line-233"></a>
<a name="line-234"></a>&lt;&lt;doc/generated/examples/floodFillImg.png floodFillImg&gt;&gt;
<a name="line-235"></a>
<a name="line-236"></a>&lt;<a href="http://goo.gl/9XIIne">http://goo.gl/9XIIne</a> OpenCV Sphinx Doc&gt;
<a name="line-237"></a>-}</span>
<a name="line-238"></a><span class='hs-definition'>floodFill</span>
<a name="line-239"></a>    <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span> <span class='hs-conid'>PrimMonad</span> <span class='hs-varid'>m</span>
<a name="line-240"></a>       <span class='hs-layout'>,</span> <span class='hs-varid'>channels</span> <span class='hs-varop'>`In`</span> <span class='hs-chr'>'</span><span class='hs-keyglyph'>[</span> <span class='hs-chr'>'</span><span class='hs-conid'>S</span> <span class='hs-num'>1</span><span class='hs-layout'>,</span> <span class='hs-chr'>'</span><span class='hs-conid'>S</span> <span class='hs-num'>3</span> <span class='hs-keyglyph'>]</span>
<a name="line-241"></a>       <span class='hs-layout'>,</span> <span class='hs-varid'>depth</span> <span class='hs-varop'>`In`</span> <span class='hs-chr'>'</span><span class='hs-keyglyph'>[</span> <span class='hs-chr'>'</span><span class='hs-conid'>D</span><span class='hs-layout'>,</span> <span class='hs-chr'>'</span><span class='hs-conid'>S</span> <span class='hs-conid'>Word8</span><span class='hs-layout'>,</span> <span class='hs-chr'>'</span><span class='hs-conid'>S</span> <span class='hs-conid'>Float</span><span class='hs-layout'>,</span> <span class='hs-chr'>'</span><span class='hs-conid'>S</span> <span class='hs-conid'>Double</span> <span class='hs-keyglyph'>]</span>
<a name="line-242"></a>       <span class='hs-layout'>,</span> <span class='hs-conid'>IsPoint2</span> <span class='hs-varid'>point2</span> <span class='hs-conid'>Int32</span>
<a name="line-243"></a>       <span class='hs-layout'>,</span> <span class='hs-conid'>ToScalar</span> <span class='hs-varid'>color</span>
<a name="line-244"></a>       <span class='hs-layout'>)</span>
<a name="line-245"></a>    <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Mut</span> <span class='hs-layout'>(</span><span class='hs-conid'>Mat</span> <span class='hs-varid'>shape</span> <span class='hs-varid'>channels</span> <span class='hs-varid'>depth</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>PrimState</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span>
<a name="line-246"></a>        <span class='hs-comment'>-- ^ Input/output 1- or 3-channel, 8-bit, or floating-point image. It is modified by the function unless the FLOODFILL_MASK_ONLY flag is set.</span>
<a name="line-247"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>Mut</span> <span class='hs-layout'>(</span><span class='hs-conid'>Mat</span> <span class='hs-layout'>(</span><span class='hs-conid'>WidthAndHeightPlusTwo</span> <span class='hs-varid'>shape</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-chr'>'</span><span class='hs-conid'>S</span> <span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-chr'>'</span><span class='hs-conid'>S</span> <span class='hs-conid'>Word8</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>PrimState</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-248"></a>        <span class='hs-comment'>-- ^ Operation mask that should be a single-channel 8-bit image, 2 pixels wider and 2 pixels taller than image. Since this is both an input and output parameter, you must take responsibility of initializing it. Flood-filling cannot go across non-zero pixels in the input mask. For example, an edge detector output can be used as a mask to stop filling at edges. On output, pixels in the mask corresponding to filled pixels in the image are set to 1 or to the a value specified in flags as described below. It is therefore possible to use the same mask in multiple calls to the function to make sure the filled areas do not overlap.</span>
<a name="line-249"></a>        <span class='hs-comment'>-- Note: Since the mask is larger than the filled image, a pixel  (x, y) in image corresponds to the pixel  (x+1, y+1) in the mask.</span>
<a name="line-250"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>point2</span> <span class='hs-conid'>Int32</span>
<a name="line-251"></a>        <span class='hs-comment'>-- ^ Starting point.</span>
<a name="line-252"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>color</span>
<a name="line-253"></a>        <span class='hs-comment'>-- ^ New value of the repainted domain pixels.</span>
<a name="line-254"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-varid'>color</span>
<a name="line-255"></a>        <span class='hs-comment'>-- ^ Maximal lower brightness/color difference between the currently observed pixel and one of its neighbors belonging to the component, or a seed pixel being added to the component. Zero by default.</span>
<a name="line-256"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-varid'>color</span>
<a name="line-257"></a>        <span class='hs-comment'>-- ^ Maximal upper brightness/color difference between the currently observed pixel and one of its neighbors belonging to the component, or a seed pixel being added to the component. Zero by default.</span>
<a name="line-258"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>FloodFillOperationFlags</span>
<a name="line-259"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-conid'>Rect2i</span>
<a name="line-260"></a><span class='hs-definition'>floodFill</span> <span class='hs-varid'>img</span> <span class='hs-varid'>mbMask</span> <span class='hs-varid'>seedPoint</span> <span class='hs-varid'>color</span> <span class='hs-varid'>mLoDiff</span> <span class='hs-varid'>mUpDiff</span> <span class='hs-varid'>opFlags</span> <span class='hs-keyglyph'>=</span>
<a name="line-261"></a>    <span class='hs-varid'>unsafePrimToPrim</span> <span class='hs-varop'>$</span>
<a name="line-262"></a>    <span class='hs-varid'>withPtr</span> <span class='hs-varid'>img</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>matPtr</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-263"></a>    <span class='hs-varid'>withPtr</span> <span class='hs-varid'>mbMask</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>maskPtr</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-264"></a>    <span class='hs-varid'>withPtr</span> <span class='hs-layout'>(</span><span class='hs-varid'>toPoint</span> <span class='hs-varid'>seedPoint</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>seedPointPtr</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-265"></a>    <span class='hs-varid'>withPtr</span> <span class='hs-layout'>(</span><span class='hs-varid'>toScalar</span> <span class='hs-varid'>color</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>colorPtr</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-266"></a>    <span class='hs-varid'>withPtr</span> <span class='hs-varid'>loDiff</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>loDiffPtr</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-267"></a>    <span class='hs-varid'>withPtr</span> <span class='hs-varid'>upDiff</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>upDiffPtr</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-268"></a>    <span class='hs-varid'>withPtr</span> <span class='hs-varid'>rect</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>rectPtr</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-269"></a>      <span class='hs-keyglyph'>[</span><span class='hs-conid'>C</span><span class='hs-varop'>.</span><span class='hs-varid'>block</span><span class='hs-keyglyph'>|</span><span class='hs-varid'>void</span> <span class='hs-layout'>{</span>
<a name="line-270"></a>        <span class='hs-varid'>cv</span><span class='hs-keyglyph'>::</span><span class='hs-conid'>Mat</span> <span class='hs-varop'>*</span> <span class='hs-varid'>maskPtr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-conid'>Mat</span> <span class='hs-varop'>*</span> <span class='hs-varid'>maskPtr</span><span class='hs-layout'>)</span><span class='hs-layout'>;</span>
<a name="line-271"></a>        <span class='hs-varid'>cv</span><span class='hs-keyglyph'>::</span><span class='hs-varid'>floodFill</span><span class='hs-layout'>(</span> <span class='hs-varop'>*$</span><span class='hs-layout'>(</span><span class='hs-conid'>Mat</span> <span class='hs-varop'>*</span> <span class='hs-varid'>matPtr</span><span class='hs-layout'>)</span>
<a name="line-272"></a>                     <span class='hs-layout'>,</span> <span class='hs-varid'>maskPtr</span> <span class='hs-varop'>?</span> <span class='hs-varid'>cv</span><span class='hs-keyglyph'>::</span><span class='hs-sel'>_InputOutputArray</span><span class='hs-layout'>(</span><span class='hs-varop'>*</span><span class='hs-varid'>maskPtr</span><span class='hs-layout'>)</span> <span class='hs-conop'>:</span> <span class='hs-varid'>cv</span><span class='hs-keyglyph'>::</span><span class='hs-sel'>_InputOutputArray</span><span class='hs-layout'>(</span><span class='hs-varid'>noArray</span><span class='hs-conid'>()</span><span class='hs-layout'>)</span>
<a name="line-273"></a>                     <span class='hs-layout'>,</span> <span class='hs-varop'>*$</span><span class='hs-layout'>(</span><span class='hs-conid'>Point2i</span> <span class='hs-varop'>*</span> <span class='hs-varid'>seedPointPtr</span><span class='hs-layout'>)</span>
<a name="line-274"></a>                     <span class='hs-layout'>,</span> <span class='hs-varop'>*$</span><span class='hs-layout'>(</span><span class='hs-conid'>Scalar</span> <span class='hs-varop'>*</span> <span class='hs-varid'>colorPtr</span><span class='hs-layout'>)</span>
<a name="line-275"></a>                     <span class='hs-layout'>,</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-conid'>Rect2i</span> <span class='hs-varop'>*</span> <span class='hs-varid'>rectPtr</span><span class='hs-layout'>)</span>
<a name="line-276"></a>                     <span class='hs-layout'>,</span> <span class='hs-varop'>*$</span><span class='hs-layout'>(</span><span class='hs-conid'>Scalar</span> <span class='hs-varop'>*</span> <span class='hs-varid'>loDiffPtr</span><span class='hs-layout'>)</span>
<a name="line-277"></a>                     <span class='hs-layout'>,</span> <span class='hs-varop'>*$</span><span class='hs-layout'>(</span><span class='hs-conid'>Scalar</span> <span class='hs-varop'>*</span> <span class='hs-varid'>upDiffPtr</span><span class='hs-layout'>)</span>
<a name="line-278"></a>                     <span class='hs-layout'>,</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>int32_t</span> <span class='hs-varid'>c'opFlags</span><span class='hs-layout'>)</span>
<a name="line-279"></a>                     <span class='hs-layout'>)</span><span class='hs-layout'>;</span>
<a name="line-280"></a>      <span class='hs-layout'>}</span><span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-281"></a>      <span class='hs-varid'>pure</span> <span class='hs-varid'>rect</span>
<a name="line-282"></a>  <span class='hs-keyword'>where</span>
<a name="line-283"></a>    <span class='hs-varid'>rect</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Rect2i</span>
<a name="line-284"></a>    <span class='hs-varid'>rect</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>toRect</span> <span class='hs-conid'>HRect</span><span class='hs-layout'>{</span> <span class='hs-varid'>hRectTopLeft</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pure</span> <span class='hs-num'>0</span>
<a name="line-285"></a>                       <span class='hs-layout'>,</span> <span class='hs-varid'>hRectSize</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pure</span> <span class='hs-num'>0</span>
<a name="line-286"></a>                       <span class='hs-layout'>}</span>
<a name="line-287"></a>    <span class='hs-varid'>c'opFlags</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>marshalFloodFillOperationFlags</span> <span class='hs-varid'>opFlags</span>
<a name="line-288"></a>    <span class='hs-varid'>zeroScalar</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>toScalar</span> <span class='hs-layout'>(</span><span class='hs-varid'>pure</span> <span class='hs-num'>0</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>V4</span> <span class='hs-conid'>Double</span><span class='hs-layout'>)</span>
<a name="line-289"></a>    <span class='hs-varid'>loDiff</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>maybe</span> <span class='hs-varid'>zeroScalar</span> <span class='hs-varid'>toScalar</span> <span class='hs-varid'>mLoDiff</span>
<a name="line-290"></a>    <span class='hs-varid'>upDiff</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>maybe</span> <span class='hs-varid'>zeroScalar</span> <span class='hs-varid'>toScalar</span> <span class='hs-varid'>mUpDiff</span>
<a name="line-291"></a>
<a name="line-292"></a><a name="FloodFillOperationFlags"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>FloodFillOperationFlags</span>
<a name="line-293"></a>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>FloodFillOperationFlags</span>
<a name="line-294"></a>   <span class='hs-layout'>{</span> <span class='hs-varid'>floodFillConnectivity</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Word8</span>
<a name="line-295"></a>      <span class='hs-comment'>-- ^ Connectivity value. The default value of 4 means that only the four nearest neighbor pixels (those that share</span>
<a name="line-296"></a>      <span class='hs-comment'>-- an edge) are considered. A connectivity value of 8 means that the eight nearest neighbor pixels (those that share</span>
<a name="line-297"></a>      <span class='hs-comment'>-- a corner) will be considered.</span>
<a name="line-298"></a>   <span class='hs-layout'>,</span> <span class='hs-varid'>floodFillMaskFillColor</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Word8</span>
<a name="line-299"></a>      <span class='hs-comment'>-- ^ Value between 1 and 255 with which to fill the mask (the default value is 1).</span>
<a name="line-300"></a>   <span class='hs-layout'>,</span> <span class='hs-varid'>floodFillFixedRange</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span>
<a name="line-301"></a>      <span class='hs-comment'>-- ^ If set, the difference between the current pixel and seed pixel is considered. Otherwise, the difference</span>
<a name="line-302"></a>      <span class='hs-comment'>-- between neighbor pixels is considered (that is, the range is floating).</span>
<a name="line-303"></a>   <span class='hs-layout'>,</span> <span class='hs-varid'>floodFillMaskOnly</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span>
<a name="line-304"></a>      <span class='hs-comment'>-- ^ If set, the function does not change the image ( newVal is ignored), and only fills the mask with the</span>
<a name="line-305"></a>      <span class='hs-comment'>-- value specified in bits 8-16 of flags as described above. This option only make sense in function variants</span>
<a name="line-306"></a>      <span class='hs-comment'>-- that have the mask parameter.</span>
<a name="line-307"></a>   <span class='hs-layout'>}</span>
<a name="line-308"></a>
<a name="line-309"></a><a name="defaultFloodFillOperationFlags"></a><span class='hs-definition'>defaultFloodFillOperationFlags</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>FloodFillOperationFlags</span>
<a name="line-310"></a><span class='hs-definition'>defaultFloodFillOperationFlags</span> <span class='hs-keyglyph'>=</span>
<a name="line-311"></a>    <span class='hs-conid'>FloodFillOperationFlags</span>
<a name="line-312"></a>    <span class='hs-layout'>{</span> <span class='hs-varid'>floodFillConnectivity</span> <span class='hs-keyglyph'>=</span> <span class='hs-num'>4</span>
<a name="line-313"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>floodFillMaskFillColor</span> <span class='hs-keyglyph'>=</span> <span class='hs-num'>1</span>
<a name="line-314"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>floodFillFixedRange</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-315"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>floodFillMaskOnly</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-316"></a>    <span class='hs-layout'>}</span>
<a name="line-317"></a>
<a name="line-318"></a><a name="marshalFloodFillOperationFlags"></a><span class='hs-definition'>marshalFloodFillOperationFlags</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>FloodFillOperationFlags</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int32</span>
<a name="line-319"></a><span class='hs-definition'>marshalFloodFillOperationFlags</span> <span class='hs-varid'>opFlags</span> <span class='hs-keyglyph'>=</span>
<a name="line-320"></a>    <span class='hs-keyword'>let</span> <span class='hs-varid'>connectivityBits</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fromIntegral</span> <span class='hs-layout'>(</span><span class='hs-varid'>floodFillConnectivity</span> <span class='hs-varid'>opFlags</span><span class='hs-layout'>)</span>
<a name="line-321"></a>        <span class='hs-varid'>maskFillColorBits</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fromIntegral</span> <span class='hs-layout'>(</span><span class='hs-varid'>floodFillMaskFillColor</span> <span class='hs-varid'>opFlags</span><span class='hs-layout'>)</span> <span class='hs-varop'>`shiftL`</span> <span class='hs-num'>8</span>
<a name="line-322"></a>        <span class='hs-varid'>fixedRangeBits</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>floodFillFixedRange</span> <span class='hs-varid'>opFlags</span> <span class='hs-keyword'>then</span> <span class='hs-varid'>c'FLOODFILL_FIXED_RANGE</span> <span class='hs-keyword'>else</span> <span class='hs-num'>0</span>
<a name="line-323"></a>        <span class='hs-varid'>fillMaskOnlyBits</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>floodFillMaskOnly</span> <span class='hs-varid'>opFlags</span> <span class='hs-keyword'>then</span> <span class='hs-varid'>c'FLOODFILL_MASK_ONLY</span> <span class='hs-keyword'>else</span> <span class='hs-num'>0</span>
<a name="line-324"></a>    <span class='hs-keyword'>in</span> <span class='hs-varid'>connectivityBits</span> <span class='hs-varop'>.|.</span> <span class='hs-varid'>maskFillColorBits</span> <span class='hs-varop'>.|.</span> <span class='hs-varid'>fixedRangeBits</span> <span class='hs-varop'>.|.</span> <span class='hs-varid'>fillMaskOnlyBits</span>
<a name="line-325"></a>
<a name="line-326"></a><span class='hs-comment'>-- TODO (RvD): Otsu and triangle are only implemented for 8 bit images.</span>
<a name="line-327"></a>
<a name="line-328"></a><a name="threshold"></a><span class='hs-comment'>{- | Applies a fixed-level threshold to each array element
<a name="line-329"></a>
<a name="line-330"></a>The function applies fixed-level thresholding to a single-channel array. The
<a name="line-331"></a>function is typically used to get a bi-level (binary) image out of a
<a name="line-332"></a>grayscale image or for removing a noise, that is, filtering out pixels with
<a name="line-333"></a>too small or too large values. There are several types of thresholding
<a name="line-334"></a>supported by the function.
<a name="line-335"></a>
<a name="line-336"></a>&lt;<a href="http://docs.opencv.org/3.0-last-rst/modules/imgproc/doc/miscellaneous_transformations.html#threshold">http://docs.opencv.org/3.0-last-rst/modules/imgproc/doc/miscellaneous_transformations.html#threshold</a> OpenCV Sphinx doc&gt;
<a name="line-337"></a>-}</span>
<a name="line-338"></a><span class='hs-definition'>threshold</span>
<a name="line-339"></a>    <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-varid'>depth</span> <span class='hs-varop'>`In`</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Word8</span><span class='hs-layout'>,</span> <span class='hs-conid'>Float</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-340"></a>    <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>ThreshValue</span> <span class='hs-comment'>-- ^</span>
<a name="line-341"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ThreshType</span>
<a name="line-342"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Mat</span> <span class='hs-varid'>shape</span> <span class='hs-layout'>(</span><span class='hs-chr'>'</span><span class='hs-conid'>S</span> <span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-chr'>'</span><span class='hs-conid'>S</span> <span class='hs-varid'>depth</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-343"></a>    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CvExcept</span> <span class='hs-layout'>(</span><span class='hs-conid'>Mat</span> <span class='hs-varid'>shape</span> <span class='hs-layout'>(</span><span class='hs-chr'>'</span><span class='hs-conid'>S</span> <span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-chr'>'</span><span class='hs-conid'>S</span> <span class='hs-varid'>depth</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>Double</span><span class='hs-layout'>)</span>
<a name="line-344"></a><span class='hs-definition'>threshold</span> <span class='hs-varid'>threshVal</span> <span class='hs-varid'>threshType</span> <span class='hs-varid'>src</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unsafeWrapException</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<a name="line-345"></a>    <span class='hs-varid'>dst</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>newEmptyMat</span>
<a name="line-346"></a>    <span class='hs-varid'>alloca</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>calcThreshPtr</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-347"></a>      <span class='hs-varid'>handleCvException</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varid'>unsafeCoerceMat</span> <span class='hs-varid'>dst</span><span class='hs-layout'>,</span> <span class='hs-layout'>)</span> <span class='hs-varop'>.</span> <span class='hs-varid'>realToFrac</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>peek</span> <span class='hs-varid'>calcThreshPtr</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span>
<a name="line-348"></a>      <span class='hs-varid'>withPtr</span> <span class='hs-varid'>src</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>srcPtr</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-349"></a>      <span class='hs-varid'>withPtr</span> <span class='hs-varid'>dst</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>dstPtr</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-350"></a>        <span class='hs-keyglyph'>[</span><span class='hs-varid'>cvExcept</span><span class='hs-keyglyph'>|</span>
<a name="line-351"></a>          <span class='hs-varop'>*$</span><span class='hs-layout'>(</span><span class='hs-varid'>double</span> <span class='hs-varop'>*</span> <span class='hs-varid'>calcThreshPtr</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-352"></a>            <span class='hs-varid'>cv</span><span class='hs-keyglyph'>::</span><span class='hs-varid'>threshold</span><span class='hs-layout'>(</span> <span class='hs-varop'>*$</span><span class='hs-layout'>(</span><span class='hs-conid'>Mat</span> <span class='hs-varop'>*</span> <span class='hs-varid'>srcPtr</span><span class='hs-layout'>)</span>
<a name="line-353"></a>                         <span class='hs-layout'>,</span> <span class='hs-varop'>*$</span><span class='hs-layout'>(</span><span class='hs-conid'>Mat</span> <span class='hs-varop'>*</span> <span class='hs-varid'>dstPtr</span><span class='hs-layout'>)</span>
<a name="line-354"></a>                         <span class='hs-layout'>,</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>double</span> <span class='hs-varid'>c'threshVal</span><span class='hs-layout'>)</span>
<a name="line-355"></a>                         <span class='hs-layout'>,</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>double</span> <span class='hs-varid'>c'maxVal</span><span class='hs-layout'>)</span>
<a name="line-356"></a>                         <span class='hs-layout'>,</span> <span class='hs-varop'>$</span><span class='hs-layout'>(</span><span class='hs-varid'>int32_t</span> <span class='hs-varid'>c'type</span><span class='hs-layout'>)</span>
<a name="line-357"></a>                         <span class='hs-layout'>)</span><span class='hs-layout'>;</span>
<a name="line-358"></a>        <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
<a name="line-359"></a>  <span class='hs-keyword'>where</span>
<a name="line-360"></a>    <span class='hs-varid'>c'type</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>c'threshType</span> <span class='hs-varop'>.|.</span> <span class='hs-varid'>c'threshValMode</span>
<a name="line-361"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>c'threshType</span><span class='hs-layout'>,</span> <span class='hs-varid'>c'maxVal</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>marshalThreshType</span> <span class='hs-varid'>threshType</span>
<a name="line-362"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>c'threshValMode</span><span class='hs-layout'>,</span> <span class='hs-varid'>c'threshVal</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>marshalThreshValue</span> <span class='hs-varid'>threshVal</span>
<a name="line-363"></a>
<a name="line-364"></a>
<a name="line-365"></a><a name="watershed"></a><span class='hs-comment'>{- | Performs a marker-based image segmentation using the watershed algorithm.
<a name="line-366"></a>
<a name="line-367"></a>The function implements one of the variants of watershed, non-parametric marker-based segmentation algorithm, described in [Meyer, F. Color Image Segmentation, ICIP92, 1992].
<a name="line-368"></a>
<a name="line-369"></a>Before passing the image to the function, you have to roughly outline the desired regions in the image markers with positive (&gt;0) indices. So, every region is represented as one or more connected components with the pixel values 1, 2, 3, and so on. Such markers can be retrieved from a binary mask using 'findContours' and 'drawContours'. The markers are seeds of the future image regions. All the other pixels in markers , whose relation to the outlined regions is not known and should be defined by the algorithm, should be set to 0s. In the function output, each pixel in markers is set to a value of the seed components or to -1 at boundaries between the regions.
<a name="line-370"></a>
<a name="line-371"></a>&lt;<a href="http://docs.opencv.org/3.0-last-rst/modules/imgproc/doc/miscellaneous_transformations.html#watershed">http://docs.opencv.org/3.0-last-rst/modules/imgproc/doc/miscellaneous_transformations.html#watershed</a> OpenCV Sphinx doc&gt;
<a name="line-372"></a>-}</span>
<a name="line-373"></a><span class='hs-definition'>watershed</span>
<a name="line-374"></a>  <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>PrimMonad</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span>
<a name="line-375"></a>  <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Mat</span> <span class='hs-layout'>(</span><span class='hs-chr'>'</span><span class='hs-conid'>S</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>h</span><span class='hs-layout'>,</span> <span class='hs-varid'>w</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-chr'>'</span><span class='hs-conid'>S</span> <span class='hs-num'>3</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-chr'>'</span><span class='hs-conid'>S</span> <span class='hs-conid'>Word8</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- ^ Input 8-bit 3-channel image</span>
<a name="line-376"></a>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Mut</span> <span class='hs-layout'>(</span><span class='hs-conid'>Mat</span> <span class='hs-layout'>(</span><span class='hs-chr'>'</span><span class='hs-conid'>S</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>h</span><span class='hs-layout'>,</span> <span class='hs-varid'>w</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-chr'>'</span><span class='hs-conid'>S</span> <span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-chr'>'</span><span class='hs-conid'>S</span> <span class='hs-conid'>Int32</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>PrimState</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- ^ Input/output 32-bit single-channel image (map) of markers</span>
<a name="line-377"></a>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CvExceptT</span> <span class='hs-varid'>m</span> <span class='hs-conid'>()</span>
<a name="line-378"></a><span class='hs-definition'>watershed</span> <span class='hs-varid'>img</span> <span class='hs-varid'>markers</span> <span class='hs-keyglyph'>=</span>
<a name="line-379"></a>    <span class='hs-varid'>unsafePrimToPrim</span> <span class='hs-varop'>$</span>
<a name="line-380"></a>    <span class='hs-varid'>withPtr</span> <span class='hs-varid'>img</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>imgPtr</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-381"></a>    <span class='hs-varid'>withPtr</span> <span class='hs-varid'>markers</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>markersPtr</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-382"></a>      <span class='hs-keyglyph'>[</span><span class='hs-conid'>C</span><span class='hs-varop'>.</span><span class='hs-varid'>exp</span><span class='hs-keyglyph'>|</span><span class='hs-varid'>void</span> <span class='hs-layout'>{</span>
<a name="line-383"></a>        <span class='hs-varid'>cv</span><span class='hs-keyglyph'>::</span><span class='hs-varid'>watershed</span><span class='hs-layout'>(</span> <span class='hs-varop'>*$</span><span class='hs-layout'>(</span><span class='hs-conid'>Mat</span> <span class='hs-varop'>*</span> <span class='hs-varid'>imgPtr</span><span class='hs-layout'>)</span>
<a name="line-384"></a>                     <span class='hs-layout'>,</span> <span class='hs-varop'>*$</span><span class='hs-layout'>(</span><span class='hs-conid'>Mat</span> <span class='hs-varop'>*</span> <span class='hs-varid'>markersPtr</span><span class='hs-layout'>)</span>
<a name="line-385"></a>                     <span class='hs-layout'>)</span>
<a name="line-386"></a>      <span class='hs-layout'>}</span><span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
</pre></body>
</html>
